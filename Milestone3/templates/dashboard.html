<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crowd Count Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <!-- Chart.js for M3 charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="sidebar">
    <h2>Crowd Count</h2>
    <ul>
      <li><a href="#" class="is-active">ğŸ“Š Dashboard</a></li>
      <li><a href="#">ğŸ¥ Video Analytics</a></li>
      <li><a href="#">ğŸ‘¤ Profile</a></li>

      <!-- Admin-only items (hidden by default) -->
      <li class="admin-only hidden">
        <a href="/admin/cameras">ğŸ“· Camera Management</a>
      </li>
      <li class="admin-only hidden">
        <a href="/admin/logs">ğŸ“‘ System Logs</a>
      </li>
      <li class="admin-only hidden">
        <a href="/admin/reports">ğŸ“„ Reports</a>
      </li>

      <li><a href="#" id="logoutBtn">ğŸšª Logout</a></li>
    </ul>
  </div>

  <div class="main-content">
    <header>
      <h1>Welcome, {{ user.name }} ğŸ™‹</h1>
    </header>

    <section class="card">
      <h2>Dashboard Overview ğŸ“‘</h2>
      <p class="muted">
        Interactive dashboard with real-time analytics, visualizations, and alert system.
      </p>
    </section>

    <!-- âœ… Video Controls -->
    <section class="card">
      <h2>Video Controls ğŸ›ï¸</h2>

      <div class="row">
        <button id="btnStartCam">â–¶ï¸ Start Camera</button>
        <button id="btnStopCam">â¹ Stop Camera</button>

        <label class="fileInput">
          ğŸ“ Choose Video
          <input type="file" id="videoFile" accept="video/*" />
        </label>
        <button id="btnUploadVideo">ğŸ¬ Use Video</button>

        <label class="fileInput">
          ğŸ–¼ Choose Image
          <input type="file" id="imageFile" accept="image/*" />
        </label>
        <button id="btnUploadImage">ğŸ–¼ Use Image</button>
      </div>

      <small class="muted">*Camera or uploaded video/image will display below.</small>
    </section>

    <!-- âœ… Live Feed + Zones -->
    <section class="card">
      <h2>Live Camera ğŸ¥</h2>

      <div id="videoWrap" class="videoWrap">
        <img id="feed" src="/video" alt="Live feed" />
        <canvas id="zoneCanvas"></canvas>
      </div>

      <div class="tools row" style="margin-top:10px;">
        <input id="zoneName" placeholder="Zone name (e.g., Entrance)" />
        <button id="btnStart">Draw Zone</button>
        <button id="btnSave" disabled>Save</button>
        <button id="btnCancel" disabled>Cancel</button>

        <!-- new precise tools -->
        <button id="drawLineBtn" title="Draw a 2-point counting line">â– Draw Line</button>
        <button id="drawPolyBtn" title="Draw polygon zone">ğŸ”º Draw Polygon</button>
        <button id="editBtn" title="Pick and edit existing zone">âœï¸ Edit Zone</button>
      </div>

      <div class="legend">
        <span class="pill">Line zone â†’ <b>crossings</b></span>
        <span class="pill">Polygon zone â†’ <b>occupancy</b></span>
      </div>
    </section>

    <!-- âœ… Zones + Live Stats + Alerts -->
    <section class="card" style="display:grid; gap:10px;">
      <h2>Zones ğŸ—ºï¸</h2>
      <ul id="zoneList"></ul>

      <h3 style="margin-top:10px;">Live Stats ğŸ“ˆ</h3>
      <div id="liveStats"></div>

      <div class="row" style="margin-top:8px;">
        <div class="badge">Alert Threshold</div>
        <input class="input" type="number" id="alertThreshold" value="20" style="width:100px;">
        <button class="btn" id="toggleAlerts">Enable Alerts</button>
        <div class="right row">
          <button class="btn secondary" id="btnExportCSV">â¬‡ï¸ Export CSV</button>
          <button class="btn secondary" id="btnExportPDF">â¬‡ï¸ Export PDF</button>
          <select id="exportWindow" class="select">
            <option value="15">Last 15 min</option>
            <option value="60">Last 60 min</option>
            <option value="240">Last 4 hours</option>
          </select>
        </div>
      </div>

      <div id="alertBanner" class="alert warn hidden">
        <strong>âš ï¸ Crowd Alert:</strong> People count exceeded threshold.
      </div>
    </section>

    <!-- âœ… Live Analytics (REPLACED with scrollable cards) -->
    <!-- Live Analytics ğŸ“Š -->
    <section class="card">
      <h2>Live Analytics ğŸ“Š</h2>

      <!-- top row: line | bar -->
      <div class="grid charts-grid">
        <div class="chart-card scroll-card">
          <div class="chart-card-header">People Over Time</div>
          <div class="chart-card-body">
            <canvas id="lineChart" class="chart-canvas" height="220"></canvas>
          </div>
        </div>

        <div class="chart-card scroll-card">
          <div class="chart-card-header">Zone Occupancy</div>
          <div class="chart-card-body">
            <canvas id="barChart" class="chart-canvas" height="220"></canvas>
          </div>
        </div>
      </div>

      <!-- bottom: heatmap full width -->
      <div class="chart-card scroll-card" style="margin-top:14px;">
        <div class="chart-card-header">Density Heatmap</div>
        <div class="chart-card-body">
          <canvas id="heatmapCanvas" class="chart-canvas" height="320"></canvas>
        </div>
      </div>
    </section>
  </div>

  <!-- JS -->
  <script src="{{ url_for('static', filename='auth.js') }}"></script>
  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
